!function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";var n,o,s,r,a,h;i(18),s=i(2),o=i(7),h=i(1),a=i(4),r=s.DOM.div,n=s.createClass({textures:{},player:{},getInitialState:function(){return{loading:!0,init:!1}},handleLoading:function(t,e,i){return e!==i||this.state.init?void 0:(this.heightMap=a.getImageData(this.textures.heightMap.image),this.setState({init:!0},this.init))},componentWillMount:function(){var t,e,i,n;THREE.DefaultLoadingManager.onProgress=this.handleLoading,i=h.textures,n=[];for(t in i)e=i[t],n.push("string"==typeof e?this.textures[t]=new THREE.ImageUtils.loadTexture(e):this.textures[t]=new THREE.ImageUtils.loadTextureCube(e));return n},init:function(){var t,e;return e=h.respawns,t=e[Math.floor(Math.random()*e.length)],this.player.position=function(t,e,i){i.prototype=t.prototype;var n=new i,o=t.apply(n,e);return Object(o)===o?o:n}(THREE.Vector3,t.position,function(){}),this.player.rotation=new THREE.Vector3(0,t.rotation,0),this.setState({loading:!1})},render:function(){return this.state.loading?r({id:"loading"},"Loading..."):o({dataServer:document.getElementById("bundle").dataset.server,player:this.player,textures:this.textures,heightMap:this.heightMap})}}),s.render(s.createElement(n),document.getElementById("app"))},function(t){t.exports={eventType:{stand:0,crwalk:1,run:2,jump:3,attack:4},textures:{dirt:"textures/dirt-512.jpg",grass:"textures/grass-512.jpg",heightMap:"textures/height_map_1024.png",rock:"textures/rock-512.jpg",sand:"textures/sand-512.jpg",skyBox:["textures/front.jpg","textures/back.jpg","textures/up.jpg","textures/down.jpg","textures/right.jpg","textures/left.jpg"],snow:"textures/snow-512.jpg",wall:"textures/wall.JPG",woodCrate:"textures/crate.gif",metal:"textures/metal.jpg",step:"textures/step.jpg",mud:"textures/mud.jpg"},models:{ratamahatta:{baseUrl:"textures/ratamahatta",body:"ratamahatta.json",skins:["ratamahatta.png"],weapons:[["weapon.json","weapon.png"]]}},respawns:[{position:[-279,60,426],rotation:-1.57},{position:[100,0,0],rotation:0},{position:[0,0,300],rotation:0},{position:[243,0,-493],rotation:3.14},{position:[-357,0,96],rotation:3.14},{position:[497,0,465],rotation:0},{position:[-470,0,-481],rotation:3.14},{position:[-464,0,115],rotation:0},{position:[-185,0,479],rotation:0},{position:[498,0,-46],rotation:0},{position:[341,120,200],rotation:1.57},{position:[-46,60,-180],rotation:-1.57},{position:[474,60,-466],rotation:1.57}]}},function(t){t.exports=React},function(t,e,i){var n,o,s,r,a,h,c,p=function(t,e){function i(){this.constructor=t}for(var n in e)d.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},d={}.hasOwnProperty,l=function(t,e){return function(){return t.apply(e,arguments)}};c=i(4),o=function(t){function e(t,i,n,o){this.width=t,this.height=i,this.depth=n,this.color=o,e.__super__.constructor.call(this,new THREE.BoxGeometry(this.width,this.height,this.depth),new THREE.MeshBasicMaterial({color:this.color}))}return p(e,t),e}(THREE.Mesh),h=function(t){function e(t,i,n,o,s,r,a){this.width=t,this.height=i,this.depth=n,s&&(o.wrapS=o.wrapT=THREE.RepeatWrapping,o.repeat.set(r,a)),e.__super__.constructor.call(this,new THREE.BoxGeometry(this.width,this.height,this.depth),new THREE.MeshPhongMaterial({map:o,specular:1118481,shininess:50,metal:!0}))}return p(e,t),e}(THREE.Mesh),a=function(t){function e(t,i,n,o){var s;this.width=t,this.height=i,this.depth=n,s=THREE.ShaderLib.cube,s.uniforms.tCube.value=o,e.__super__.constructor.call(this,new THREE.BoxGeometry(this.width,this.height,this.depth),new THREE.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:s.uniforms,depthWrite:!1,side:THREE.BackSide}))}return p(e,t),e}(THREE.Mesh),r=function(t){function e(t,i,n,o,s){n.wrapS=n.wrapT=THREE.RepeatWrapping,n.repeat.set(o,s),e.__super__.constructor.call(this,new THREE.PlaneBufferGeometry(t,i),new THREE.MeshLambertMaterial({map:n}))}return p(e,t),e}(THREE.Mesh),n=function(t){function e(t,i,n,o,s){var r,a;this.scene=t,this.objects=o,null==s&&(s={}),this.destroy=l(this.destroy,this),this.move=l(this.move,this),this.speed=s.speed||20,a=s.size||1,r=s.color||"white",e.__super__.constructor.call(this,new THREE.SphereGeometry(a,15,15),new THREE.MeshBasicMaterial({color:r})),this.position.copy(i),this.direction=this.getDirection(n),this.rayCaster=new THREE.Raycaster,this.rayCaster.far=this.speed,this.rayCaster.ray.direction.copy(this.direction)}return p(e,t),e.prototype.died=!1,e.prototype.getDirection=function(t){var e,i,n;return e=-Math.sin(t.y),i=Math.sin(t.x),n=-Math.cos(t.y),new THREE.Vector3(e,i,n)},e.prototype.move=function(){var t,e;if(!this.died)return this.position.x+=this.direction.x*this.speed,this.position.y+=this.direction.y*this.speed,this.position.z+=this.direction.z*this.speed,this.rayCaster.ray.origin.copy(this.position),t=this.rayCaster.intersectObjects(this.objects),t.length>0?(e=t[0].object,e instanceof THREE.MorphAnimMesh&&"function"==typeof this.killed&&this.killed(e),this.destroy()):void 0},e.prototype.destroy=function(){return this.died?void 0:(this.died=!0,this.scene.remove(this))},e.prototype.fire=function(t){return this.killed=t,this.scene.add(this),setInterval(this.move,16),setTimeout(this.destroy,2e3)},e}(THREE.Mesh),s=function(t){function e(t,i,n,o){var s,r,a,h,c,p;null==o&&(o=200),a=n.heightMap,a.wrapS=a.wrapT=THREE.RepeatWrapping,s=n.dirt,s.wrapS=s.wrapT=THREE.RepeatWrapping,c=n.sand,c.wrapS=c.wrapT=THREE.RepeatWrapping,r=n.grass,r.wrapS=r.wrapT=THREE.RepeatWrapping,h=n.rock,h.wrapS=h.wrapT=THREE.RepeatWrapping,p=n.snow,p.wrapS=p.wrapT=THREE.RepeatWrapping,e.__super__.constructor.call(this,new THREE.PlaneBufferGeometry(t,i,100,100),new THREE.ShaderMaterial({uniforms:{heightMap:{type:"t",value:a},scale:{type:"f",value:o},dirtTexture:{type:"t",value:s},sandyTexture:{type:"t",value:c},grassTexture:{type:"t",value:r},rockyTexture:{type:"t",value:h},snowyTexture:{type:"t",value:p}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader}))}return p(e,t),e.prototype.vertexShader="uniform sampler2D heightMap;\nuniform float scale;\n\nvarying float vAmount;\nvarying vec2 vUV;\n\nvoid main()\n{\n  vUV = uv;\n  vec4 img = texture2D(heightMap, uv);\n\n  // assuming map is grayscale it doesn't matter if you use r, g, or b.\n  vAmount = img.r;\n\n  // move the position along the normal\n  vec3 newPosition = position + normal * scale * vAmount;\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);\n}",e.prototype.fragmentShader="uniform sampler2D dirtTexture;\nuniform sampler2D sandyTexture;\nuniform sampler2D grassTexture;\nuniform sampler2D rockyTexture;\nuniform sampler2D snowyTexture;\n\nvarying vec2 vUV;\n\nvarying float vAmount;\n\nvoid main()\n{\n  vec4 dirt = (smoothstep(0.01, 0.05, vAmount) - smoothstep(0.02, 0.26, vAmount)) * texture2D( dirtTexture, vUV * 10.0 );\n  vec4 sand = (smoothstep(0.08, 0.27, vAmount) - smoothstep(0.30, 0.33, vAmount)) * texture2D( sandyTexture, vUV * 10.0 );\n  vec4 grass = (smoothstep(0.30, 0.33, vAmount) - smoothstep(0.34, 0.35, vAmount)) * texture2D( grassTexture, vUV * 20.0 );\n  vec4 rock = (smoothstep(0.30, 0.38, vAmount) - smoothstep(0.65, 0.75, vAmount)) * texture2D( rockyTexture, vUV * 20.0 );\n  vec4 snow = (smoothstep(0.65, 0.75, vAmount))                                   * texture2D( snowyTexture, vUV * 10.0 );\n\n  gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0) + dirt + sand + grass + rock + snow;\n}",e}(THREE.Mesh),t.exports={ColorCube:o,Plane:r,SkyBox:a,HeightMap:s,Bullet:n,TexturedCube:h}},function(t,e){e.getImageData=function(t){var e,i;return e=document.createElement("canvas"),e.width=t.width,e.height=t.height,i=e.getContext("2d"),i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height)},e.getPixel=function(t,e,i){var n,o;return o=4*(e+t.width*i),n=t.data,{r:n[o],g:n[o+1],b:n[o+2],a:n[o+3]}}},function(){THREE.MD2Character=function(){function t(t,e){for(var n=THREE.UVMapping,o=[],s=0;s<e.length;s++)o[s]=THREE.ImageUtils.loadTexture(t+e[s],n,i),o[s].name=e[s];return o}function e(t,e){t.computeMorphNormals();var i=THREE.ImageUtils.generateDataTexture(1,1,new THREE.Color(16777215)),o=new THREE.MeshPhongMaterial({color:16755200,specular:1118481,shininess:50,wireframe:!0,shading:THREE.SmoothShading,map:i,morphTargets:!0,morphNormals:!0,metal:!1}),s=new THREE.MeshPhongMaterial({color:16777215,specular:1118481,shininess:50,wireframe:!1,shading:THREE.SmoothShading,map:e,morphTargets:!0,morphNormals:!0,metal:!1});s.wrapAround=!0;var r=new THREE.MorphAnimMesh(t,s);return r.rotation.y=-Math.PI/2,r.castShadow=!0,r.receiveShadow=!0,r.materialTexture=s,r.materialWireframe=o,r.parseAnimations(),r.playAnimation(t.firstAnimation,n.animationFPS),r.baseDuration=r.duration,r}function i(){n.loadCounter-=1,0===n.loadCounter&&n.onLoadComplete()}var n=this;this.scale=1,this.animationFPS=6,this.root=new THREE.Object3D,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.onLoadComplete=function(){},this.loadCounter=0,this.loadParts=function(o){this.loadCounter=2*o.weapons.length+o.skins.length+1;for(var s=[],r=0;r<o.weapons.length;r++)s[r]=o.weapons[r][1];this.skinsBody=t(o.baseUrl+"/",o.skins),this.skinsWeapon=t(o.baseUrl+"/",s);var a=new THREE.JSONLoader;a.load(o.baseUrl+"/"+o.body,function(t){t.computeBoundingBox();var o=e(t,n.skinsBody[0]);o.scale.set(n.scale,n.scale,n.scale),n.root.add(o),n.meshBody=o,n.activeAnimation=t.firstAnimation,i()});for(var h=function(t,o){return function(s){var r=e(s,n.skinsWeapon[t]);r.scale.set(n.scale,n.scale,n.scale),r.visible=!1,r.name=o,n.root.add(r),n.weapons[t]=r,n.meshWeapon=r,i()}},c=0;c<o.weapons.length;c++)a.load(o.baseUrl+"/"+o.weapons[c][0],h(c,o.weapons[c][0]))},this.setPlaybackRate=function(t){this.meshBody&&(this.meshBody.duration=this.meshBody.baseDuration/t),this.meshWeapon&&(this.meshWeapon.duration=this.meshWeapon.baseDuration/t)},this.setWireframe=function(t){t?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(t){this.meshBody&&this.meshBody.material.wireframe===!1&&(this.meshBody.material.map=this.skinsBody[t])},this.setWeapon=function(t){for(var e=0;e<this.weapons.length;e++)this.weapons[e].visible=!1;var i=this.weapons[t];i&&(i.visible=!0,this.meshWeapon=i,i.playAnimation(this.activeAnimation,this.animationFPS),this.meshWeapon.baseDuration=this.meshWeapon.duration,this.meshWeapon.time=this.meshBody.time,this.meshWeapon.duration=this.meshBody.duration)},this.setAnimation=function(t){this.meshBody&&(this.meshBody.playAnimation(t,this.animationFPS),this.meshBody.baseDuration=this.meshBody.duration),this.meshWeapon&&(this.meshWeapon.playAnimation(t,this.animationFPS),this.meshWeapon.baseDuration=this.meshWeapon.duration,this.meshWeapon.time=this.meshBody.time),this.activeAnimation=t},this.update=function(t){this.meshBody&&this.meshBody.updateAnimation(1e3*t),this.meshWeapon&&this.meshWeapon.updateAnimation(1e3*t)}}},function(t,e,i){var n,o,s,r,a;o=i(2),a=o.DOM,s=a.div,r=a.span,n=o.createClass({getInitialState:function(){return{havePointerLock:!1,pointerLocked:!1}},handleClick:function(){var t;return t=this.refs.blocker.getDOMNode(),t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock()},handleLockChange:function(){var t,e;return t=this.refs.blocker.getDOMNode(),e=document.pointerLockElement===t||document.mozPointerLockElement===t||document.webkitPointerLockElement===t,this.setState({pointerLocked:e}),this.props.sendState(this.state)},componentDidMount:function(){var t;return t="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,this.setState({havePointerLock:t}),t?(document.addEventListener("pointerlockchange",this.handleLockChange),document.addEventListener("mozpointerlockchange",this.handleLockChange),document.addEventListener("webkitpointerlockchange",this.handleLockChange)):void 0},componentWillUnmount:function(){return document.removeEventListener("pointerlockchange",this.handleLockChange),document.removeEventListener("mozpointerlockchange",this.handleLockChange),document.removeEventListener("webkitpointerlockchange",this.handleLockChange)},render:function(){var t,e;return this.state.havePointerLock?(e="Click to play",t="(W, A, S, D = Move, SPACE = Jump, MOUSE = Look around)"):(e="Sorry",t="Your browser doesn't seem to support Pointer Lock API"),s({id:"blocker",ref:"blocker",onClick:this.handleClick,style:{opacity:this.state.pointerLocked?0:1}},s({id:"instructions"},r({},e),r({},t)))}}),t.exports=function(t){return null==t&&(t=null),o.createElement(n,t)}},function(t,e,i){var n,o,s,r,a,h,c,p,d,l,u,m,f,y;h=i(2),p=i(16),n=i(6),o=i(9),r=i(3),a=i(10),c=i(12),d=i(8),m=i(4),f=i(1),i(5),y=h.DOM,l=y.canvas,u=y.div,s=h.createClass({players:{},textures:{},clock:new THREE.Clock,stats:new p,shootingDelay:!1,getInitialState:function(){return{frameCount:0,fps:0,windowWidth:window.innerWidth,windowHeight:window.innerHeight,pointerLocked:!1}},handleResize:function(){return this.setState({windowWidth:window.innerWidth,windowHeight:window.innerHeight})},handleBlockerState:function(t){return this.setState({pointerLocked:t.pointerLocked})},handleMouseMove:function(t){return this.state.pointerLocked?this.controls.handleMouseMove(t):void 0},handleFire:function(){var t,e,i,n,o,s;return this.state.pointerLocked&&!this.controls.fired?(this.controls.fired=!0,o=function(t){return function(){return t.controls.fired=!1}}(this),setTimeout(o,1120),s=this.controls,i=s.position,n=s.rotation,t=this.playGround.meshes,e={size:.4,color:"yellow"},this.bullet=new r.Bullet(this.scene,i,n,t,e),this.bullet.fire(function(t){return function(e){var i,n,o,s,r;s=e.uuid,r=t.players;for(i in r)n=r[i],n.meshBody.uuid===s&&(o=i);return t.sockets.kill(o)}}(this))):void 0},resetFrameCount:function(){return setTimeout(this.resetFrameCount,1e3),this.setState({frameCount:0,fps:this.state.frameCount})},initScene:function(){var t,e,i,n,s;for(this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(45,this.state.windowWidth/this.state.windowHeight,1,1e4),this.renderer=new THREE.WebGLRenderer({canvas:this.refs.render.getDOMNode(),antialias:!1}),this.renderer.setClearColor(16777215),this.renderer.setSize(this.state.windowWidth,this.state.windowHeight),this.renderer.shadowMapEnabled=!0,this.ambientLight=new THREE.AmbientLight(4210752),this.directionalLight=new THREE.DirectionalLight(16777215,1),this.directionalLight.position.set(-520,520,1e3),this.directionalLight.castShadow=!0,this.directionalLight.shadowCameraLeft=-720,this.directionalLight.shadowCameraRight=700,this.directionalLight.shadowCameraBottom=-300,this.directionalLight.shadowCameraNear=550,this.directionalLight.shadowCameraFar=1850,this.playGround=new a(this.props.textures),this.sockets=new c(this.props.dataServer,this.scene,this.players,this.playGround),this.controls=new o(this.camera,this.props.player,this.playGround.meshes),this.scene.add(this.ambientLight),this.scene.add(this.directionalLight),this.scene.add(this.controls.getCamera()),n=this.playGround.meshes,s=[],e=0,i=n.length;i>e;e++)t=n[e],s.push(this.scene.add(t));return s},renderFrame:function(){var t,e,i,n;t=this.clock.getDelta(),this.controls.update(t,this.state.pointerLocked),this.sockets.update(this.controls),n=this.players;for(e in n)i=n[e],i.update(t);return this.renderer.render(this.scene,this.camera)},animate:function(){return this.setState({frameCount:++this.state.frameCount}),this.stats.begin(),this.renderFrame(),this.stats.end(),requestAnimationFrame(this.animate)},componentDidMount:function(){return this.resetFrameCount(),this.initScene(),window.addEventListener("resize",this.handleResize),window.addEventListener("mousemove",this.handleMouseMove),this.animate()},shouldComponentUpdate:function(){return!0},componentWillUpdate:function(){return this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},componentWillUnmount:function(){return window.removeEventListener("resize",this.handleResize),window.addEventListener("mousemove",this.handleMouseMove)},render:function(){return u({id:"wrapper",onClick:this.handleFire},u({id:"crosshair",style:{top:this.state.windowHeight/2-43,left:this.state.windowWidth/2-43,opacity:this.state.pointerLocked?1:0,backgroundImage:"url('crosshair.png')"}}),n({sendState:this.handleBlockerState}),d({stats:this.stats}),l({id:"render",ref:"render",style:{width:this.state.windowWidth,height:this.state.windowHeight}}))}}),t.exports=function(t){return null==t&&(t=null),h.createElement(s,t)}},function(t,e,i){var n,o,s;n=i(2),s=n.DOM.div,o=n.createClass({render:function(){return s({id:"stats",style:{position:"absolute"},dangerouslySetInnerHTML:{__html:this.props.stats.domElement.innerHTML}})}}),t.exports=function(t){return null==t&&(t=null),n.createElement(o,t)}},function(t,e,i){var n,o;o=i(15),n=function(){function t(t,e,i){this.objects=i,this.cameraPitch=t,this.cameraYaw=new THREE.Object3D,this.cameraYaw.add(this.cameraPitch),e.position.y+=this.defaultHeight,this.cameraYaw.position.copy(e.position),this.cameraYaw.rotation.y=e.rotation.y,this.updateProps()}return t.prototype.defaultHeight=12,t.prototype.defaultSpeed=10,t.prototype.rayCaster=new THREE.Raycaster,t.prototype.velocity=new THREE.Vector3,t.prototype.animation="stand",t.prototype.fired=!1,t.prototype.jumped=!1,t.prototype.moved=!1,t.prototype.sprinted=!1,t.prototype.intersects=[],t.prototype.directions={axe:new THREE.Vector3(0,1,0),"default":new THREE.Vector3(0,0,1),down:new THREE.Vector3(0,-1,0)},t.prototype.updateProps=function(){var t,e;return this.position=this.cameraYaw.position,t=this.cameraPitch.rotation._x,e=this.cameraYaw.rotation._y,this.rotation=new THREE.Vector3(t,e),this.animation="stand",this.moved&&(this.animation="crwalk"),this.jumped&&(this.animation="jump"),this.moved&&this.sprinted&&(this.animation="run"),this.fired?this.animation="attack":void 0},t.prototype.getCamera=function(){return this.cameraYaw},t.prototype.getIntersect=function(t,e){var i;return null==e&&(e=1/0),this.rayCaster.set(this.cameraYaw.position,t),this.rayCaster.far=e,i=this.rayCaster.intersectObjects(this.objects),i.length>0?i[0]:!1},t.prototype.update=function(t,e){var i,n,s,r,a,h,c,p,d,l,u,m,f,y;if(e){for(this.updateProps(),this.velocity.y-=9.823*t,m=o.isPressed("W"),u=o.isPressed("S"),d=o.isPressed("A"),l=o.isPressed("D"),this.moved=m||u||d||l,this.sprinted=o.shift,f=this.sprinted?2*this.defaultSpeed:this.defaultSpeed,s=this.getIntersect(this.directions.down,1e3).distance,this.height=Math.abs(Math.round(this.position.y-s))+this.defaultHeight,i=Math.PI/4,n=this.directions["default"].clone().applyAxisAngle(this.directions.axe,this.rotation.y),this.intersects[0]=!!this.getIntersect(n,f),r=y=1;7>=y;r=++y)n=n.applyAxisAngle(this.directions.axe,i),this.intersects[r]=!!this.getIntersect(n,f);return a=this.intersects[7]||this.intersects[0]||this.intersects[1],p=this.intersects[1]||this.intersects[2]||this.intersects[3],h=this.intersects[3]||this.intersects[4]||this.intersects[5],c=this.intersects[5]||this.intersects[6]||this.intersects[7],this.moved&&(m&&!h&&(this.velocity.z-=f*t),u&&!a&&(this.velocity.z+=f*t),d&&!c&&(this.velocity.x-=f*t),l&&!p&&(this.velocity.x+=f*t)),o.isPressed("space")&&(this.jumped||(this.velocity.y+=3),this.jumped=!0),this.cameraYaw.translateX(this.velocity.x),this.cameraYaw.translateY(this.velocity.y),this.cameraYaw.translateZ(this.velocity.z),this.cameraYaw.position.y<this.height&&(this.jumped=!1,this.velocity.y=0,this.cameraYaw.position.y=this.height),this.velocity.x-=this.velocity.x*this.defaultSpeed*t,this.velocity.z-=this.velocity.z*this.defaultSpeed*t}},t.prototype.handleMouseMove=function(t){var e,i;return e=t.movementX||t.mozMovementX||t.webkitMovementX||0,i=t.movementY||t.mozMovementY||t.webkitMovementY||0,this.cameraYaw.rotation.y-=.002*e,this.cameraPitch.rotation.x-=.002*i,this.cameraPitch.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.cameraPitch.rotation.x))},t}(),t.exports=n},function(t,e,i){var n,o,s,r,a;a=i(3),n=a.Plane,r=a.TexturedCube,s=a.SkyBox,o=function(){function t(t){var e,i,o,a,h,c,p,d,l,u,m,f,y,g,v,w,E,x,k,T,b,M,C,S,R,H,L,P,A,W,B,D;for(k=function(t,e,i){return new THREE.Vector3(t,e,i)},w=new s(8e3,8e3,8e3,t.skyBox),this.meshes.push(w),y=new THREE.Object3D,d=new n(1024,1024,t.grass,16,16),d.rotation.x-=Math.PI/2,y.add(d),this.meshes.push(d),p=new n(1024,128,t.wall,16,2),p.rotation.y=Math.PI,p.position.set(0,64,512),y.add(p),this.meshes.push(p),l=new n(1024,128,t.wall,16,2),l.rotation.y-=Math.PI/2,l.position.set(512,64,0),y.add(l),this.meshes.push(l),u=new n(1024,128,t.wall,16,2),u.rotation.y=Math.PI/2,u.position.set(-512,64,0),y.add(u),this.meshes.push(u),c=new n(1024,128,t.wall,16,2),c.position.set(0,64,-512),y.add(c),this.meshes.push(c),this.pyramid=new THREE.Object3D,f=[k(15,22.5,0),k(0,22.5,15),k(15,22.5,15),k(0,22.5,-15),k(-15,22.5,0),k(-15,22.5,-15),k(-15,22.5,15),k(15,22.5,-15),k(-30,7.5,30),k(-30,7.5,-30),k(30,7.5,-30),k(30,7.5,30),k(15,7.5,30),k(0,7.5,30),k(-15,7.5,30),k(30,7.5,15),k(30,7.5,0),k(30,7.5,-15),k(-30,7.5,-15),k(-30,7.5,0),k(-30,7.5,15),k(-15,7.5,-30),k(0,7.5,-30),k(15,7.5,-30),k(0,37.5,0)],T=0,S=f.length;S>T;T++)m=f[T],o=new r(15,15,15,t.woodCrate,!1),m.z+=100,o.position.copy(m),this.pyramid.add(o),this.meshes.push(o);for(g=new n(64,132,t.mud,1,4),g.rotation.x-=2*Math.PI/3,g.position.set(-390,27,305),this.meshes.push(g),v=new r(250,60,150,t.rock,!0,12,5),v.position.set(387,30,-437),this.meshes.push(v),v=new r(300,60,150,t.rock,!0,12,5),v.position.set(-362,30,437),this.meshes.push(v),f=[k(467,7.5,-357),k(467,22.5,-357),k(467,37.5,-357),k(467,7.5,-347),k(467,22.5,-347),k(467,7.5,-337),k(-342,67.5,367),k(-282,67.5,367),k(-232,67.5,367)],b=0,R=f.length;R>b;b++)m=f[b],x=new r(30,15,10,t.step,!0,1,1),x.position.copy(m),this.meshes.push(x);for(f=[k(350,30,350),k(-250,30,-352),k(-352,30,0),k(-352,90,0),k(-292,30,0),k(-412,30,0),k(-292,30,120),k(-352,90,120),k(-412,30,120),k(-292,30,180),k(-337,30,-90),k(337,30,165),k(337,90,165),k(397,30,165),k(455,30,-50),k(200,30,228),k(-50,30,-182)],a=M=0,H=f.length;H>M;a=++M)m=f[a],e=new r(60,60,120,t.metal,!0,2,1),e.position.copy(m),(10===a||16===a)&&(e.rotation.y=Math.PI/2),this.meshes.push(e);for(f=[k(497,15,497),k(497,45,497),k(467,15,497),k(497,75,-378),k(437,75,-378),k(377,75,-378),k(317,75,-378),k(276,75,-378),k(276,75,-438),k(276,75,-497),k(467,15,437),k(327,15,437),k(227,15,437),k(127,15,437),k(27,15,437),k(-27,15,437),k(-127,15,437),k(-127,15,200),k(-127,15,-350),k(-307,75,-0),k(395,15,262)],C=0,L=f.length;L>C;C++)m=f[C],i=new r(30,30,30,t.woodCrate,!1),i.position.copy(m),this.meshes.push(i);for(f=[k(-254.5,7.5,0),k(-254.5,22.5,0),k(-254.5,37.5,0),k(-239.5,7.5,0),k(-239.5,22.5,0),k(-224.5,7.5,0),k(238,7.5,278),k(238,22.5,278),k(238,37.5,278),k(253,7.5,278),k(253,22.5,278),k(268,7.5,278)],W=0,P=f.length;P>W;W++)m=f[W],E=new r(15,15,15,t.woodCrate,!1),E.position.copy(m),this.meshes.push(E);for(D=this.meshes,B=0,A=D.length;A>B;B++)h=D[B],h.castShadow=!0,h.receiveShadow=!0;this.meshes[1].castShadow=!1}return t.prototype.meshes=[],t}(),t.exports=o},function(t,e,i){var n,o,s,r=function(t,e){return function(){return t.apply(e,arguments)}},a=function(t,e){function i(){this.constructor=t}for(var n in e)h.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},h={}.hasOwnProperty;i(5),s=i(1),n=i(3).Bullet,o=function(t){function e(t,i,n){this.scene=i,this.playground=n,this.afterKill=r(this.afterKill,this),e.__super__.constructor.call(this),this.loadParts(s.models.ratamahatta),this.root.position.copy(t.position),this.scale=.5,this.scene.add(this.root),this.onLoadComplete=function(t){return function(){return t.setWeapon(0),t.playground.meshes.push(t.meshBody),t.playground.meshes.push(t.meshWeapon)}}(this)}return a(e,t),e.prototype.onUpdate=function(t){var e;return this.root.position.copy(t.position),this.root.rotation.y=t.rotation.y+Math.PI,this.animation=t.animation,this.lastAnimation!==this.animation&&this.meshWeapon&&this.meshBody?("attack"===this.animation&&(e=new n(this.scene,t.position,t.rotation,this.playground.meshes),e.fire()),this.lastAnimation=this.animation,this.setAnimation(this.animation)):void 0},e.prototype.onKill=function(){return this.setAnimation("crdeath"),setTimeout(this.afterKill,640)},e.prototype.afterKill=function(){return this.setAnimation("stand")},e}(THREE.MD2Character),t.exports=o},function(t,e,i){var n,o,s,r=function(t,e){return function(){return t.apply(e,arguments)}};n=i(11),s=i(1).eventType,o=function(){function t(t,e,i,n){this.scene=e,this.players=i,this.playground=n,this.onLeave=r(this.onLeave,this),this.onDataUpdate=r(this.onDataUpdate,this),this.onKill=r(this.onKill,this),this.sendUpdate=r(this.sendUpdate,this),this.socket=io.connect({path:t}),this.socket.on("data",this.onDataUpdate),this.socket.on("leave",this.onLeave),this.socket.on("kill",this.onKill),setInterval(this.sendUpdate,16)}return t.prototype.kill=function(t){return this.socket.emit("kill",t)},t.prototype.update=function(t){return this.controls=t},t.prototype.pack=function(t){var e,i,n,o,r,a,h;for(e=new ArrayBuffer(41),n=new Uint8Array(e,0,20),r=new Float32Array(e,20,3),a=new Float32Array(e,32,2),i=new Uint8Array(e,40,1),o=h=0;20>=h;o=++h)n[o]=this.socket.id.charCodeAt(o);return r[0]=t.position.x,r[1]=t.position.y,r[2]=t.position.z,a[0]=t.rotation.x,a[1]=t.rotation.y,i[0]=s[t.event],e},t.prototype.unpack=function(t){var e,i,n,o,r;return i=Object.keys(s),n=new Uint8Array(t.slice(0,20)),o=new Float32Array(t.slice(20,32)),r=new Float32Array(t.slice(32,40)),e=new Uint8Array(t.slice(40,41)),{id:String.fromCharCode.apply(null,n),position:function(t,e,i){i.prototype=t.prototype;var n=new i,o=t.apply(n,e);return Object(o)===o?o:n}(THREE.Vector3,o,function(){}),rotation:function(t,e,i){i.prototype=t.prototype;var n=new i,o=t.apply(n,e);return Object(o)===o?o:n}(THREE.Vector3,r,function(){}),animation:i[e[0]]}},t.prototype.sendUpdate=function(){var t;if(this.controls&&this.socket.id)return t=this.pack({position:this.controls.position,rotation:this.controls.rotation,event:this.controls.animation}),this.socket.emit("data",t)},t.prototype.onKill=function(t){var e;if(t!==this.socket.id)return null!=(e=this.players[t])?e.onKill():void 0},t.prototype.onDataUpdate=function(t){var e,i;return e=this.unpack(t),i=e.id,i in this.players?this.players[i].onUpdate(e):this.players[i]=new n(e,this.scene,this.playground)},t.prototype.onLeave=function(t){return t in this.players?(this.scene.remove(this.players[t].root),delete this.players[t]):void 0},t}(),t.exports=o},function(t){t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var i=this[e];t.push(i[2]?"@media "+i[2]+"{"+i[1]+"}":i[1])}return t.join("")},t}},function(t,e,i){e=t.exports=i(13)(),e.push([t.id,"*{padding:0;margin:0}html{width:100%;height:100%}html,body{overflow:hidden}body{margin:0;padding:0}body,canvas,#blocker{width:100%;height:100%}#blocker{position:absolute;background-color:rgba(0,0,0,.5);display:table;text-align:center;cursor:pointer;color:#fff}#instructions{vertical-align:middle;display:table-cell;width:100%}#instructions span:first-child{font-size:3em;display:block}#crosshair{width:262px;height:262px;position:absolute;background-repeat:no-repeat}",""])},function(t){!function(e){function i(t,e){for(var i=t.length;i--;)if(t[i]===e)return i;return-1}function n(t,e){if(t.length!=e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function o(t){for(E in k)k[E]=t[R[E]]}function s(t){var e,n,s,r,a,c;if(e=t.keyCode,-1==i(S,e)&&S.push(e),(93==e||224==e)&&(e=91),e in k){k[e]=!0;for(s in b)b[s]==e&&(h[s]=!0)}else if(o(t),h.filter.call(this,t)&&e in x)for(c=m(),r=0;r<x[e].length;r++)if(n=x[e][r],n.scope==c||"all"==n.scope){a=n.mods.length>0;for(s in k)(!k[s]&&i(n.mods,+s)>-1||k[s]&&-1==i(n.mods,+s))&&(a=!1);(0!=n.mods.length||k[16]||k[18]||k[17]||k[91])&&!a||n.method(t,n)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0))}}function r(t){var e,n=t.keyCode,o=i(S,n);if(o>=0&&S.splice(o,1),(93==n||224==n)&&(n=91),n in k){k[n]=!1;for(e in b)b[e]==n&&(h[e]=!1)}}function a(){for(E in k)k[E]=!1;for(E in b)h[E]=!1}function h(t,e,i){var n,o;n=y(t),void 0===i&&(i=e,e="all");for(var s=0;s<n.length;s++)o=[],t=n[s].split("+"),t.length>1&&(o=g(t),t=[t[t.length-1]]),t=t[0],t=C(t),t in x||(x[t]=[]),x[t].push({shortcut:n[s],scope:e,method:i,key:n[s],mods:o})}function c(t,e){var i,o,s,r,a,h=[];for(i=y(t),r=0;r<i.length;r++){if(o=i[r].split("+"),o.length>1&&(h=g(o),t=o[o.length-1]),t=C(t),void 0===e&&(e=m()),!x[t])return;for(s=0;s<x[t].length;s++)a=x[t][s],a.scope===e&&n(a.mods,h)&&(x[t][s]={})}}function p(t){return"string"==typeof t&&(t=C(t)),-1!=i(S,t)}function d(){return S.slice(0)}function l(t){var e=(t.target||t.srcElement).tagName;return!("INPUT"==e||"SELECT"==e||"TEXTAREA"==e)}function u(t){T=t||"all"}function m(){return T||"all"}function f(t){var e,i,n;for(e in x)for(i=x[e],n=0;n<i.length;)i[n].scope===t?i.splice(n,1):n++}function y(t){var e;return t=t.replace(/\s/g,""),e=t.split(","),""==e[e.length-1]&&(e[e.length-2]+=","),e}function g(t){for(var e=t.slice(0,t.length-1),i=0;i<e.length;i++)e[i]=b[e[i]];return e}function v(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&t.attachEvent("on"+e,function(){i(window.event)})}function w(){var t=e.key;return e.key=H,t}var E,x={},k={16:!1,18:!1,17:!1,91:!1},T="all",b={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},M={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},C=function(t){return M[t]||t.toUpperCase().charCodeAt(0)},S=[];for(E=1;20>E;E++)M["f"+E]=111+E;var R={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(E in b)h[E]=!1;v(document,"keydown",function(t){s(t)}),v(document,"keyup",r),v(window,"focus",a);var H=e.key;e.key=h,e.key.setScope=u,e.key.getScope=m,e.key.deleteScope=f,e.key.filter=l,e.key.isPressed=p,e.key.getPressedKeyCodes=d,e.key.noConflict=w,e.key.unbind=c,t.exports=h}(this)},function(t){var e=function(){var t=Date.now(),e=t,i=0,n=1/0,o=0,s=0,r=1/0,a=0,h=0,c=0,p=document.createElement("div");p.id="stats",p.addEventListener("mousedown",function(t){t.preventDefault(),v(++c%2)},!1),p.style.cssText="width:80px;opacity:0.9;cursor:pointer";var d=document.createElement("div");d.id="fps",d.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",p.appendChild(d);var l=document.createElement("div");l.id="fpsText",l.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",l.innerHTML="FPS",d.appendChild(l);var u=document.createElement("div");for(u.id="fpsGraph",u.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",d.appendChild(u);74>u.children.length;){var m=document.createElement("span");m.style.cssText="width:1px;height:30px;float:left;background-color:#113",u.appendChild(m)}var f=document.createElement("div");f.id="ms",f.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",p.appendChild(f);var y=document.createElement("div");y.id="msText",y.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",y.innerHTML="MS",f.appendChild(y);
var g=document.createElement("div");for(g.id="msGraph",g.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",f.appendChild(g);74>g.children.length;)m=document.createElement("span"),m.style.cssText="width:1px;height:30px;float:left;background-color:#131",g.appendChild(m);var v=function(t){switch(c=t){case 0:d.style.display="block",f.style.display="none";break;case 1:d.style.display="none",f.style.display="block"}};return{REVISION:12,domElement:p,setMode:v,begin:function(){t=Date.now()},end:function(){var c=Date.now();i=c-t,n=Math.min(n,i),o=Math.max(o,i),y.textContent=i+" MS ("+n+"-"+o+")";var p=Math.min(30,30-30*(i/200));return g.appendChild(g.firstChild).style.height=p+"px",h++,c>e+1e3&&(s=Math.round(1e3*h/(c-e)),r=Math.min(r,s),a=Math.max(a,s),l.textContent=s+" FPS ("+r+"-"+a+")",p=Math.min(30,30-30*(s/100)),u.appendChild(u.firstChild).style.height=p+"px",e=c,h=0),c},update:function(){t=this.end()}}};"object"==typeof t&&(t.exports=e)},function(t){function e(t,e){for(var i=0;i<t.length;i++){var n=t[i],s=h[n.id];if(s){s.refs++;for(var r=0;r<s.parts.length;r++)s.parts[r](n.parts[r]);for(;r<n.parts.length;r++)s.parts.push(o(n.parts[r],e))}else{for(var a=[],r=0;r<n.parts.length;r++)a.push(o(n.parts[r],e));h[n.id]={id:n.id,refs:1,parts:a}}}}function i(t){for(var e=[],i={},n=0;n<t.length;n++){var o=t[n],s=o[0],r=o[1],a=o[2],h=o[3],c={css:r,media:a,sourceMap:h};i[s]?i[s].parts.push(c):e.push(i[s]={id:s,parts:[c]})}return e}function n(){var t=document.createElement("style"),e=d();return t.type="text/css",e.appendChild(t),t}function o(t,e){var i,o,s;if(e.singleton){var h=u++;i=l||(l=n()),o=r.bind(null,i,h,!1),s=r.bind(null,i,h,!0)}else i=n(),o=a.bind(null,i),s=function(){i.parentNode.removeChild(i)};return o(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;o(t=e)}else s()}}function s(t,e,i){var n=["/** >>"+e+" **/","/** "+e+"<< **/"],o=t.lastIndexOf(n[0]),s=i?n[0]+i+n[1]:"";if(t.lastIndexOf(n[0])>=0){var r=t.lastIndexOf(n[1])+n[1].length;return t.slice(0,o)+s+t.slice(r)}return t+s}function r(t,e,i,n){var o=i?"":n.css;if(t.styleSheet)t.styleSheet.cssText=s(t.styleSheet.cssText,e,o);else{var r=document.createTextNode(o),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}function a(t,e){var i=e.css,n=e.media,o=e.sourceMap;if(o&&"function"==typeof btoa)try{i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(JSON.stringify(o))+" */",i='@import url("data:text/css;base64,'+btoa(i)+'")'}catch(s){}if(n&&t.setAttribute("media",n),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var h={},c=function(t){var e;return function(){return"undefined"==typeof e&&(e=t.apply(this,arguments)),e}},p=c(function(){return/msie 9\b/.test(window.navigator.userAgent.toLowerCase())}),d=c(function(){return document.head||document.getElementsByTagName("head")[0]}),l=null,u=0;t.exports=function(t,n){n=n||{},"undefined"==typeof n.singleton&&(n.singleton=p());var o=i(t);return e(o,n),function(t){for(var s=[],r=0;r<o.length;r++){var a=o[r],c=h[a.id];c.refs--,s.push(c)}if(t){var p=i(t);e(p,n)}for(var r=0;r<s.length;r++){var c=s[r];if(0===c.refs){for(var d=0;d<c.parts.length;d++)c.parts[d]();delete h[c.id]}}}}},function(t,e,i){var n=i(14);"string"==typeof n&&(n=[[t.id,n,""]]);i(17)(n,{})}]);